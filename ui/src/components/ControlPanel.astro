---
// Control panel with file upload, mode detection, charge strategy and actions
import ServerConfig from './ServerConfig.astro';
---

<div class="panel animate-slide-up" style="position: relative;">
  <h2 class="text-heading" style="margin-bottom: var(--space-4); color: hsl(var(--foreground));">Control Panel</h2>
  
  <!-- BotÃ³n limpiar en esquina inferior derecha -->
  <button id="clear-project-btn" class="btn btn--ghost" style="position: absolute; bottom: var(--space-6); right: var(--space-6); padding: var(--space-2); min-width: auto; transition: all var(--duration-fast) var(--ease-out);" title="Limpiar Proyecto">
    ðŸ§¹
  </button>
  
  <!-- Server Configuration -->
  <ServerConfig />
  
  <!-- Project Configuration -->
  <div style="margin-top: var(--space-6);">
    <div style="margin-bottom: var(--space-4);">
      <label class="text-body" style="display: block; font-weight: 500; margin-bottom: var(--space-2); color: hsl(var(--foreground));">Project File</label>
      <input type="file" id="project-file" accept=".json" class="input">
      <div id="file-status" class="text-caption text-muted" style="margin-top: var(--space-2);">No file selected</div>
      <div id="file-analysis" class="text-caption text-primary" style="margin-top: var(--space-1); display: none;"></div>
      
      <!-- Loading progress bar -->
      <div id="file-loading-progress" style="margin-top: var(--space-3); display: none;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: var(--space-1);">
          <span class="text-caption text-muted">Loading project...</span>
          <span id="file-loading-percentage" class="text-caption text-muted">0%</span>
        </div>
        <div class="progress">
          <div id="file-loading-bar" class="progress__bar" style="width: 0%"></div>
        </div>
      </div>
    </div>

    <!-- Control Buttons -->
    <div style="display: flex; flex-wrap: wrap; gap: var(--space-2); margin-top: var(--space-6);">
      <button id="start-btn" class="btn btn--primary" disabled style="position: relative; overflow: hidden;">
        <span id="start-btn-text" style="transition: opacity var(--duration-normal) var(--ease-out);">Start</span>
        <div id="start-btn-spinner" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0; transition: opacity var(--duration-normal) var(--ease-out);">
          <div style="width: 16px; height: 16px; border: 2px solid hsl(var(--primary-foreground)); border-top-color: transparent; border-radius: var(--radius-full); animation: spin 1s linear infinite;"></div>
        </div>
      </button>
      <button id="pause-btn" class="btn btn--secondary" disabled>
      </button>
      <button id="stop-btn" class="btn btn--danger" disabled>
        Stop
      </button>
      <button id="one-batch-btn" class="btn btn--primary" disabled style="background-color: hsl(var(--warning)); color: hsl(var(--warning-foreground));">
        ðŸŽ¯ Un lote
      </button>
    </div>
  </div>
</div>

<style>
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
  
  /* AnimaciÃ³n especÃ­fica para el botÃ³n limpiar */
  #clear-project-btn:active {
    animation: cleanPulse 0.6s ease-in-out;
  }
</style>
